<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WCA Scramble Statistics</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <h1><a id="event-header" href="../">2x2 Statistics</a></h1>
    <!-- <a id="back-link" href="../">Back to main page</a> -->
    <!-- Primary Dropdown for Main Categories -->
    <select id="csv-selector" onchange="updateSubOptions()">
        <option value="distributions">Distributions</option>
        <option value="bestGroups">Best Groups</option>
        <option value="allXMovers">All X Movers</option>
        <option value="scrambleSequences">Scramble Sequences</option>
        <!-- Add more primary categories as needed -->
    </select>

    <!-- Secondary Dropdown for Subcategories -->
    <select id="sub-csv-selector" onchange="displaySelectedCSV()">
        <!-- This will be dynamically populated -->
    </select>

    <div id="csv-data"></div>

    <script>
        const csvFiles = {
            'distributions': ['Distributions/distribution.csv', 'Distributions/QTM_distribution.csv', 'Distributions/matchingScramblesDistribution.csv', 'Distributions/matchingStatesDistribution.csv'],
            'bestGroups' : ['Best_Groups/bestOptimalMo5.csv', 'Best_Groups/bestOptimalAo5.csv', 'Best_Groups/bestPossibleOptimalAo5.csv', 'Best_Groups/bestLayerMo5.csv', 'Best_Groups/bestLayerAo5.csv', 'Best_Groups/bestFaceMo5.csv', 'Best_Groups/bestFaceAo5.csv'],
            'allXMovers': ['All_X_Movers/4movers.csv', 'All_X_Movers/5movers.csv', 'All_X_Movers/11movers.csv'],
            'scrambleSequences' : ['Scramble_Sequences/repeatedScrambles.csv', 'Scramble_Sequences/repeatedStates.csv', 'Scramble_Sequences/halfTurnCountHigh.csv', 'Scramble_Sequences/primeTurnCountHigh.csv', 'Scramble_Sequences/normalTurnCountHigh.csv'],
            // Add more categories and their corresponding CSV files as needed
        };

        const subCategoryNames = {
            'Distributions/distribution.csv': 'Optimal HTM Distribution',
            'Distributions/QTM_distribution.csv' : 'Optimal QTM Distribution',
            'All_X_Movers/4movers.csv': 'All 4 Movers',
            'All_X_Movers/5movers.csv': 'All 5 Movers',
            'All_X_Movers/11movers.csv': 'All 11 Movers',
            'Scramble_Sequences/halfTurnCountHigh.csv' : "Most Half Turns in a Scramble",
            'Scramble_Sequences/primeTurnCountHigh.csv' : "Most Counter Clockwise Turns in a Scramble",
            'Scramble_Sequences/normalTurnCountHigh.csv' : "Most Clockwise Turns in a Scramble",
            'Distributions/matchingScramblesDistribution.csv' : "Number of Repeated Scrambles Distribution",
            'Distributions/matchingStatesDistribution.csv' : "Number of Repeated States (with symmetries) Distribution",
            'Scramble_Sequences/repeatedScrambles.csv' : "All Scrambles Repeated 4+ Times",
            'Scramble_Sequences/repeatedStates.csv' : "All States Repeated 10+ Times",
            'Best_Groups/bestOptimalMo5.csv' : "Optimal Mo5",
            'Best_Groups/bestOptimalAo5.csv' : "Optimal Ao5",
            'Best_Groups/bestPossibleOptimalAo5.csv' : "Best Possible Optimal Ao5",
            'Best_Groups/bestLayerMo5.csv' : "Optimal Layer Mo5",
            'Best_Groups/bestLayerAo5.csv' : "Optimal Layer Ao5",
            'Best_Groups/bestFaceMo5.csv' : "Optimal Face Mo5",
            'Best_Groups/bestFaceAo5.csv' : "Optimal Face Ao5",
            // Add more descriptive names for subcategories
        };

        function updateSubOptions() {
            const primaryCategory = document.getElementById('csv-selector').value;
            const subCsvSelector = document.getElementById('sub-csv-selector');

            // Clear existing options
            subCsvSelector.innerHTML = '';

            // Populate with new subcategory options
            csvFiles[primaryCategory].forEach(file => {
                const option = document.createElement('option');
                option.value = file;
                option.textContent = subCategoryNames[file];
                subCsvSelector.appendChild(option);
            });

            // Automatically display the first subcategory's CSV
            displayCSV(csvFiles[primaryCategory][0]);
        }

        function displayCSV(filename) {
            fetch(filename)
                .then(response => response.text())
                .then(text => {
                    const rows = text.split('\n').filter(row => row.trim() !== '');
                    let table = '<table>';
                    let prevRow = [];
                    let rowspans = [];
                    let colTracker = [];

                    rows.forEach((row, rowIndex) => {
                        const cols = row.split(',').map(col => col.trim());
                        cols.forEach((col, colIndex) => {
                            colTracker[colIndex] = 1;
                        });
                    });
                    

                    rows.forEach((row, rowIndex) => {
                        const cols = row.split(',').map(col => col.trim());
                        // table += '<tr>';
                        let canCombine = true;
                        
                        rowspans[rowIndex] = []
                        

                        cols.forEach((col, colIndex) => {
                            rowspans[rowIndex][colIndex] = 1;

                            if (rowIndex === 0) {
                                // Add header row
                                // table += `<th>${col}</th>`;
                                prevRow[colIndex] = col;
                            } else {
                                if (col === prevRow[colIndex] && canCombine) {
                                    colTracker[colIndex] += 1;
                                    rowspans[rowIndex - colTracker[colIndex] + 1][colIndex] = colTracker[colIndex];
                                    // rowspans[rowIndex - (rowspans[rowIndex][colIndex])][colIndex] += 1;
                                    // table += '<td></td>'; // Empty cell for duplicate value
                                } else {
                                    colTracker[colIndex] = 1;
                                    // table += `<td>${col}</td>`;
                                    canCombine = false; // Stop combining for the rest of the row
                                }
                                prevRow[colIndex] = col; // Update prevRow with the current value
                                
                            }
                            
                        });
                        // table += '</tr>';
                        
                    });

                    rows.forEach((row, rowIndex) => {
                        const cols = row.split(',').map(col => col.trim());
                        table += '<tr>';
                        let canCombine = true;
                        

                        cols.forEach((col, colIndex) => {

                            if (rowIndex === 0) {
                                // Add header row
                                table += `<th>${col}</th>`;
                                prevRow[colIndex] = col;
                            } else {
                                if (col === prevRow[colIndex] && canCombine) {
                                    // rowspans[rowIndex - (rowspans[rowIndex][colIndex])][colIndex] += 1;
                                    // table += '<td></td>'; // Empty cell for duplicate value
                                } else {
                                    table += `<td rowspan="${rowspans[rowIndex][colIndex]}">${col}</td>`;
                                    canCombine = false; // Stop combining for the rest of the row
                                }
                                prevRow[colIndex] = col; // Update prevRow with the current value
                                
                            }
                            
                        });
                        table += '</tr>';
                        
                    });

                    table += '</table>';
                    console.log(rowspans)
                    document.getElementById('csv-data').innerHTML = table;
                });
        }

        function displaySelectedCSV() {
            const selectedFile = document.getElementById('sub-csv-selector').value;
            displayCSV(selectedFile);
        }

        // Initialize with the first primary category
        updateSubOptions();
    </script>

    <a href="../">Back to main page</a>
</body>
</html>