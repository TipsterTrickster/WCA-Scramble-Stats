<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WCA Scramble Statistics</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <h1><a id="event-header" href="../">2x2_backup</a></h1>
    <select id="csv-selector" onchange="updateSubOptions()">
        
        <option value="Best_Groups">Best Groups</option>
        
        <option value="All_X_Movers">All X Movers</option>
        
        <option value="Distributions">Distributions</option>
        
        <option value="Scramble_Sequences">Scramble Sequences</option>
        
    </select>

    <!-- Secondary Dropdown for Subcategories -->
    <select id="sub-csv-selector" onchange="displaySelectedCSV()">
        <!-- This will be dynamically populated -->
    </select>

    <div id="csv-data"></div>

    <script>
        const csvFiles = {
            
            'Best_Groups': ['Best_Groups/bestLayerMo5.csv', 'Best_Groups/bestOptimalAo5.csv', 'Best_Groups/bestFaceAo5.csv', 'Best_Groups/bestFaceMo5.csv', 'Best_Groups/bestOptimalMo5.csv', 'Best_Groups/bestPossibleOptimalAo5.csv', 'Best_Groups/bestLayerAo5.csv'],
            
            'All_X_Movers': ['All_X_Movers/5movers.csv', 'All_X_Movers/11movers.csv', 'All_X_Movers/4movers.csv'],
            
            'Distributions': ['Distributions/matchingStatesDistribution.csv', 'Distributions/distribution.csv', 'Distributions/QTM_distribution.csv', 'Distributions/matchingScramblesDistribution.csv'],
            
            'Scramble_Sequences': ['Scramble_Sequences/normalTurnCountHigh.csv', 'Scramble_Sequences/repeatedStates.csv', 'Scramble_Sequences/repeatedScrambles.csv', 'Scramble_Sequences/primeTurnCountHigh.csv', 'Scramble_Sequences/halfTurnCountHigh.csv'],
            
        };

        const subCategoryNames = {
            
            'Best_Groups/bestLayerMo5.csv': 'bestLayerMo5',
            
            'Best_Groups/bestOptimalAo5.csv': 'bestOptimalAo5',
            
            'Best_Groups/bestFaceAo5.csv': 'bestFaceAo5',
            
            'Best_Groups/bestFaceMo5.csv': 'bestFaceMo5',
            
            'Best_Groups/bestOptimalMo5.csv': 'bestOptimalMo5',
            
            'Best_Groups/bestPossibleOptimalAo5.csv': 'bestPossibleOptimalAo5',
            
            'Best_Groups/bestLayerAo5.csv': 'bestLayerAo5',
            
            'All_X_Movers/5movers.csv': '5movers',
            
            'All_X_Movers/11movers.csv': '11movers',
            
            'All_X_Movers/4movers.csv': '4movers',
            
            'Distributions/matchingStatesDistribution.csv': 'matchingStatesDistribution',
            
            'Distributions/distribution.csv': 'distribution',
            
            'Distributions/QTM_distribution.csv': 'QTM distribution',
            
            'Distributions/matchingScramblesDistribution.csv': 'matchingScramblesDistribution',
            
            'Scramble_Sequences/normalTurnCountHigh.csv': 'normalTurnCountHigh',
            
            'Scramble_Sequences/repeatedStates.csv': 'repeatedStates',
            
            'Scramble_Sequences/repeatedScrambles.csv': 'repeatedScrambles',
            
            'Scramble_Sequences/primeTurnCountHigh.csv': 'primeTurnCountHigh',
            
            'Scramble_Sequences/halfTurnCountHigh.csv': 'halfTurnCountHigh',
            
        };

        function updateSubOptions() {
            const primaryCategory = document.getElementById('csv-selector').value;
            const subCsvSelector = document.getElementById('sub-csv-selector');

            // Clear existing options
            subCsvSelector.innerHTML = '';

            // Populate with new subcategory options
            csvFiles[primaryCategory].forEach(file => {
                const option = document.createElement('option');
                option.value = file;
                option.textContent = subCategoryNames[file];
                subCsvSelector.appendChild(option);
            });

            // Automatically display the first subcategory's CSV
            displayCSV(csvFiles[primaryCategory][0]);
        }

        function displayCSV(filename) {
            fetch(filename)
                .then(response => response.text())
                .then(text => {
                    const rows = text.split('\n').filter(row => row.trim() !== '');
                    let table = '<table>';
                    let prevRow = [];
                    let rowspans = [];
                    let colTracker = [];

                    rows.forEach((row, rowIndex) => {
                        const cols = row.split(',').map(col => col.trim());
                        cols.forEach((col, colIndex) => {
                            colTracker[colIndex] = 1;
                        });
                    });
                    

                    rows.forEach((row, rowIndex) => {
                        const cols = row.split(',').map(col => col.trim());
                        // table += '<tr>';
                        let canCombine = true;
                        
                        rowspans[rowIndex] = []
                        

                        cols.forEach((col, colIndex) => {
                            rowspans[rowIndex][colIndex] = 1;

                            if (rowIndex === 0) {
                                // Add header row
                                // table += `<th>${col}</th>`;
                                prevRow[colIndex] = col;
                            } else {
                                if (col === prevRow[colIndex] && canCombine) {
                                    colTracker[colIndex] += 1;
                                    rowspans[rowIndex - colTracker[colIndex] + 1][colIndex] = colTracker[colIndex];
                                    // rowspans[rowIndex - (rowspans[rowIndex][colIndex])][colIndex] += 1;
                                    // table += '<td></td>'; // Empty cell for duplicate value
                                } else {
                                    colTracker[colIndex] = 1;
                                    // table += `<td>${col}</td>`;
                                    canCombine = false; // Stop combining for the rest of the row
                                }
                                prevRow[colIndex] = col; // Update prevRow with the current value
                                
                            }
                            
                        });
                        // table += '</tr>';
                        
                    });

                    rows.forEach((row, rowIndex) => {
                        const cols = row.split(',').map(col => col.trim());
                        table += '<tr>';
                        let canCombine = true;
                        

                        cols.forEach((col, colIndex) => {

                            if (rowIndex === 0) {
                                // Add header row
                                table += `<th>${col}</th>`;
                                prevRow[colIndex] = col;
                            } else {
                                if (col === prevRow[colIndex] && canCombine) {
                                    // rowspans[rowIndex - (rowspans[rowIndex][colIndex])][colIndex] += 1;
                                    // table += '<td></td>'; // Empty cell for duplicate value
                                } else {
                                    table += `<td rowspan="${rowspans[rowIndex][colIndex]}">${col}</td>`;
                                    canCombine = false; // Stop combining for the rest of the row
                                }
                                prevRow[colIndex] = col; // Update prevRow with the current value
                                
                            }
                            
                        });
                        table += '</tr>';
                        
                    });

                    table += '</table>';
                    console.log(rowspans)
                    document.getElementById('csv-data').innerHTML = table;
                });
        }

        function displaySelectedCSV() {
            const selectedFile = document.getElementById('sub-csv-selector').value;
            displayCSV(selectedFile);
        }

        // Initialize with the first primary category
        updateSubOptions();
    </script>

    <a href="../">Back to main page</a>
</body>
</html>